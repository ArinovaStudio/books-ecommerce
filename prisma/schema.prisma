generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  SUB_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

model User {
  id String @id @default(uuid())
  email String @unique
  phone String? @unique
  name String
  password String
  address String?
  role UserRole @default(USER)
  status UserStatus @default(ACTIVE)
  schoolId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  school School? @relation(fields: [schoolId], references: [id])
  children Student[] @relation("ParentStudents")
  orders Order[] 
}

model Otp {
  id String @id @default(uuid())
  email String 
  otp String
  expiredAt DateTime
  createdAt DateTime @default(now())
}

enum SchoolStatus {
  ACTIVE
  INACTIVE
}

model School {
  id String @id @default(uuid())
  name String
  email String @unique
  address String?
  languages String[]
  classRange String
  image String
  board String?
  status SchoolStatus @default(ACTIVE)
  numberOfClasses Int @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  subAdmins User[]
  classes Class[]
  students Student[]
}

model Class {
  id String @id @default(uuid())
  schoolId String
  name String
  sections String[]
  academicYear String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  sectionDetails Section[]
  kits Kit[]
  students Student[]
  products Product[]
}

model Section {
  id String @id @default(uuid())
  name String 
  language String
  classId String

  class Class @relation(fields: [classId], references: [id], onDelete: Cascade)
  students Student[]
}

model Student {
  id String @id @default(uuid())
  parentId String?
  schoolId String
  classId String
  sectionId String?                    // ADD ? HERE
  name String
  rollNo String
  section String
  dob DateTime?
  gender String?
  bloodGroup String?
  address String?
  firstLanguage String?
  parentEmail String
  isActive Boolean @default(false) 

  parent User? @relation("ParentStudents", fields: [parentId], references: [id])
  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  class Class @relation(fields: [classId], references: [id])
  sectionDetails Section? @relation(fields: [sectionId], references: [id])  // ADD ? HERE TOO

  orders Order[] @relation("StudentOrders") 

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum ProductCategory {
  TEXTBOOK
  NOTEBOOK
  STATIONARY
  OTHER
}

model Product {
  id String @id @default(uuid())
  name String
  description String
  price Float
  category ProductCategory
  stock Int
  minQuantity Int @default(1)          // ADD @default(1) HERE
  brand String?
  type String?
  image String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  kitItems KitItem[]
  orderItems OrderItem[]
  classId String
  class Class @relation(fields:[classId],references: [id],onDelete: Cascade)
}

enum KitType {
  BASIC
  MEDIUM
  ADVANCE
}

model Kit {
  id String @id @default(uuid())
  type KitType
  classId String
  totalPrice Float
  language String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  class Class @relation(fields: [classId], references: [id], onDelete: Cascade)

  items KitItem[]
}

model KitItem {
  id String @id @default(uuid())
  kitId String
  productId String
  quantity Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  kit Kit @relation(fields: [kitId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

enum PaymentStatus {
  SUCCESS
  PENDING
  FAILED
}

model Payment {
  id String @id @default(uuid())
  orderId String
  amount Float
  status PaymentStatus @default(PENDING)
  method String
  razorpayOrderId String?
  razorpayPaymentId String?
  razorpaySignature String?
  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Order {
  id String @id
  userId String
  studentId String
  school String
  class String
  section String
  academicYear String
  phone String
  landmark String
  pincode String
  status String
  totalAmount Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  student Student @relation("StudentOrders", fields: [studentId], references: [id])

  payment Payment[]
  items OrderItem[]
}

model OrderItem {
  id String @id @default(uuid())
  orderId String
  productId String
  quantity Int
  price Float

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ContactQuery {
  id String @id @default(uuid())
  name String
  email String
  phone String?
  address String?
  message String
  createdAt DateTime @default(now())
}

model ApiTraffic {
  id String @id @default(uuid())
  hour DateTime @unique
  count Int @default(1)
}